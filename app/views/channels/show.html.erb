<div class="messages">
  <%- @messages.each do |message| %>
  <div id="message_<%= message.id %>" class="message-holder <%= 'me' if current_user == message.user %>">
    <div class="message-meta">
      <span class="message-author">
        <%= "#{message.user.name}" %>
	    </span>
      <span class="message-time">
        <%= "at #{message.created_at.strftime("%I:%M%p") }" %>
	    </span>
	    <div class = "message-content">
        <%= message.content %>
	    </div>
    </div>
  </div>
  <%- end %>
</div>

<div class="sidebar">
  <div class="rooms_title">Audio</div>
  <div class="actions">
    <%= image_tag("sound-on.png", :id => "audio_toggle") %>
  </div>

  <div id='file_list_title' class="rooms_title">Files</div>
  <%= form_tag("/channels/#{@channel.to_param}/attachments.js", :remote => true, :id => "file_upload", :html => { :multipart => true }) do |form| %>
  <%= hidden_field :channel_id, @channel.id %>
  <%= file_field_tag 'file' %>
  <%= submit_tag 'Upload' %>
  <% end %>

  <div id="files_list_holder">
    <ul class="files_list"></ul>
  </div>

  <div class="rooms_title">Rooms</div>
  <div class="rooms_list">
  </div>

  <div class="users_title">Users Online</div>
  <div class="users_list">
    <%- @users.each do |user| %>
    <%- if user[:id] == current_user.id %>
    <div class="user selected" id="<%= "user_#{user[:id]}"%>">
      <%- else %>
      <div class="user">
        <%-end %>
        <%= "#{user[:first_name]} #{user[:last_name]}" %>
      </div>
      <%- end %>
    </div>
  </div>

  <%- content_for :footer do %>
  <div class="chatbox">
    <%= form_for([@channel, @message], :remote => true) do |f| %>
    <%= f.hidden_field :channel_id, :value =>  @message.channel_id %>
    <%=f.text_area :content, :rows => 20 %>
    <%- end %>
  </div>

  <div class="actions">
    <%= image_tag("sound-on.png", :id => "audio_toggle") %>
  </div>

  <script language="javascript">
    $(document).data('channelId',         <%= "'#{@channel.to_param}\'" %>)
    $(document).data('lastMessageId',     <%= "#{@messages.try(:last).try(:id) || 0}" %>)
    $(document).data('lastReadMessageId', <%= "#{@messages.try(:last).try(:id) || 0}"  %>)
  </script>

  <%-end %>
